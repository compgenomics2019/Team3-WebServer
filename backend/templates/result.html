<!doctype html>
<head>
	<title>{{ title }}</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.7/css/jquery.dataTables.css">
	<script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.js"></script>
</head>

<body>
    <h2>{{ title }}</h2>
    <h4>Result Directory</h4>
    <div>
        {{ RES_DIR }}
    </div>
    <div>
        <p>Check <a href="/result/test1">sample result page</a></p>
    </div>

    <pre id="testgff">
    </pre>

	<script type="text/javascript">
		$(document).ready(function() {
			function tsvJSON(tsv){
				var lines=tsv.split("\n");

				var result = [];

				var headers=lines[0].split("\t");
				console.log(lines[0]);
				console.log(lines[1]);

				for(var i=1;i<lines.length-1;i++){

				  var obj = {};
				  var currentline=lines[i].split("\t");

				  for(var j=0;j<headers.length;j++){
					  obj[headers[j]] = currentline[j];
				  }

				  result.push(obj);

				}
				return result; //JavaScript object
				//return JSON.stringify(result); //JSON
			}


			$.ajax({
				type: "GET",
				url: "OUTPUT2.gff3",
				dataType: "text",
				success: function(data) {
					//console.log(data);
					//var processed = processData(data);
					//console.log(data);
					var processed = tsvJSON(data);
					console.log(processed);
					$('#table_id').DataTable( {
						data: processed,
						columns: [
							{ data: "CHROM" },
							{ data: 'SOURCE' },
							{ data: 'FEATURE' },
							{ data: 'START' },
							{ data: 'STOP' },
							{ data: 'SCORE' },
							{ data: 'STRAND' },
							{ data: 'FRAME' },
							{ data: 'ATTRIBUTE' }
						]
					});
				}
			 });
		});
	</script>

	<table id="table_id" class="display">
		<thead>
			<tr>
				<th>CHROM</th>
				<th>SOURCE</th>
				<th>FEATURE</th>
				<th>START</th>
				<th>STOP</th>
				<th>SCORE</th>
				<th>STRAND</th>
				<th>FRAME</th>
				<th>ATTRIBUTE</th>
			</tr>
		</thead>
		<tfoot>
			<tr>
				<th>CHROM</th>
				<th>SOURCE</th>
				<th>FEATURE</th>
				<th>START</th>
				<th>STOP</th>
				<th>SCORE</th>
				<th>STRAND</th>
				<th>FRAME</th>
				<th>ATTRIBUTE</th>
			</tr>
		</tfoot>
	</table>
	
	
	
	
	
    <script>
     async function load_gff() {
         const gff_file = window.location.pathname + "/OUTPUT.gff3";
         let response = await fetch(gff_file);
         let dom = document.getElementById("testgff");
         if (!response.ok)
             dom.innerHTML = response.statusText;
         dom.innerHTML = await response.text();
     }
     load_gff()
    </script>
</body>
